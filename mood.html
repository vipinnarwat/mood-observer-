<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Therapy â€” Mood Observer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --bg:#f3f6fb;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#5b86e5;
      --glass: rgba(255,255,255,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    [data-theme="dark"]{
      --bg:#111827;
      --card:#1f2937;
      --muted:#9ca3af;
      --accent:#3b82f6;
      --glass: rgba(31,41,55,0.6);
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#eef3fb);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;transition:background .3s ease}
    .container{width:100%;max-width:1100px;background:var(--card);border-radius:14px;box-shadow:0 10px 30px rgba(40,50,80,0.08);padding:28px;display:grid;grid-template-columns:1fr 360px;gap:24px;transition:background .3s ease,color .3s ease}
    header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between}
    header h1{margin:0;font-size:20px}
    header p{margin:0;color:var(--muted);font-size:13px}
    .observer{padding:18px;border-radius:12px;background:linear-gradient(180deg,#fbfdff,#f6fbff);}
    [data-theme="dark"] .observer{background:linear-gradient(180deg,#1f2937,#111827)}
    .prompt{font-size:15px;margin-bottom:12px;color:var(--muted)}
    .emoji-grid{display:flex;gap:10px;flex-wrap:wrap}
    .emoji-btn{flex:1 1 100px;border:2px solid transparent;background:transparent;padding:12px;border-radius:10px;font-size:28px;cursor:pointer;transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease}
    .emoji-btn:hover{transform:translateY(-4px)}
    .emoji-btn.selected{border-color:var(--accent);box-shadow:0 6px 18px rgba(91,134,229,0.25);transform:translateY(-6px) scale(1.02)}
    .emoji-label{display:block;margin-top:8px;font-size:13px;color:var(--muted);text-align:center}
    .result{margin-top:18px;padding:14px;border-radius:10px;background:var(--glass);backdrop-filter:blur(6px);animation:fadeIn .3s ease}
    .task-title{font-weight:600;margin:0 0 6px}
    .task-desc{margin:0;color:var(--muted);font-size:14px}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .sidebar{padding:18px;border-radius:12px;background:linear-gradient(180deg,#ffffff,#fbfdff);height:100%;display:flex;flex-direction:column;gap:12px}
    [data-theme="dark"] .sidebar{background:linear-gradient(180deg,#1f2937,#111827)}
    .history{flex:1;overflow:auto;padding:6px;border-radius:8px}
    .entry{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px}
    .entry .emoji{font-size:20px}
    .entry .meta{font-size:13px;color:var(--muted)}
    .cta{display:flex;gap:8px}
    .btn{padding:10px 12px;border-radius:10px;border:0;background:var(--accent);color:white;cursor:pointer;font-weight:600;transition:background .2s ease, transform .2s ease}
    .btn:hover{transform:translateY(-2px)}
    .btn.secondary{background:transparent;color:var(--accent);border:1px solid rgba(91,134,229,0.3)}
    footer.note{grid-column:1/-1;margin-top:6px;font-size:12px;color:var(--muted)}
    .step-counter{margin-top:12px;padding:12px;border-radius:10px;background:var(--glass);backdrop-filter:blur(6px)}
    canvas{max-width:100%;margin-top:16px}
    @media (max-width:880px){.container{grid-template-columns:1fr;} .sidebar{order:2}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1 id="app-title">Therapy â€” Mood Observer</h1>
        <p>Choose how you're feeling and get a small task to help shift your mood.</p>
      </div>
      <div style="text-align:right;display:flex;flex-direction:column;gap:4px;align-items:end">
        <small style="color:var(--muted)">Mini, friendly mental health companion</small>
        <button id="themeToggle" class="btn secondary">Toggle Theme</button>
      </div>
    </header>

    <section class="observer">
      <div class="prompt">How are you feeling right now? Select an emoji that matches your mood.</div>
      <div class="emoji-grid">
        <button class="emoji-btn" data-mood="happy"><div>ðŸ˜Š</div><span class="emoji-label">Happy</span></button>
        <button class="emoji-btn" data-mood="sad"><div>ðŸ˜”</div><span class="emoji-label">Sad</span></button>
        <button class="emoji-btn" data-mood="angry"><div>ðŸ˜¡</div><span class="emoji-label">Angry</span></button>
        <button class="emoji-btn" data-mood="anxious"><div>ðŸ˜°</div><span class="emoji-label">Anxious</span></button>
        <button class="emoji-btn" data-mood="tired"><div>ðŸ¥±</div><span class="emoji-label">Tired</span></button>
        <button class="emoji-btn" data-mood="excited"><div>ðŸ¤©</div><span class="emoji-label">Excited</span></button>
      </div>
      <div id="result" class="result" hidden>
        <p id="taskTitle" class="task-title"></p>
        <p id="taskDesc" class="task-desc"></p>
        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <button id="doneBtn" class="btn">Mark done</button>
          <button id="tryAnotherBtn" class="btn secondary">Choose different mood</button>
        </div>
      </div>
      <div class="step-counter">
        <strong>Step Counter</strong>
        <p>Steps: <span id="stepCount">0</span></p>
        <button id="resetSteps" class="btn secondary">Reset Steps</button>
      </div>
      <canvas id="moodStepChart" height="200"></canvas>
    </section>

    <aside class="sidebar">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Activity</strong>
        <div class="cta"><button id="clearHistory" class="btn secondary">Clear</button></div>
      </div>
      <div id="history" class="history"></div>
      <div style="font-size:13px;color:var(--muted);padding-top:8px;border-top:1px dashed #e6eefc">
        Tip: small, kind actions add up. This tool doesn't replace professional help.
      </div>
    </aside>

    <footer class="note">If you're in crisis, please contact local emergency services or a mental health professional.</footer>
  </div>

  <script>
    (function(){
      const tasks = {
        happy:{title:'Celebrate the moment',desc:'Take 3 deep breaths, write one gratitude, and do a kind act.'},
        sad:{title:'Small, gentle step',desc:'Try a 5-min walk or message a friend.'},
        angry:{title:'Cool down â€” 4-4-4 breathing',desc:'Breathe in 4s, hold 4s, out 4s. Then shake your arms.'},
        anxious:{title:'Grounding â€” 5-4-3-2-1',desc:'Notice 5 things you see, 4 touch, 3 hear, 2 smell, 1 taste.'},
        tired:{title:'Recharge break',desc:'Close eyes 2 min, stretch, drink water, step outside.'},
        excited:{title:'Channel your energy',desc:'Write your idea, share it, or do a happy movement!'}
      };
      const moodScores={sad:1,angry:2,anxious:3,tired:4,happy:5,excited:6};
      const buttons=document.querySelectorAll('.emoji-btn');
      const result=document.getElementById('result');
      const taskTitle=document.getElementById('taskTitle');
      const taskDesc=document.getElementById('taskDesc');
      const historyEl=document.getElementById('history');
      const doneBtn=document.getElementById('doneBtn');
      const tryAnotherBtn=document.getElementById('tryAnotherBtn');
      const clearHistory=document.getElementById('clearHistory');
      const themeToggle=document.getElementById('themeToggle');
      const stepCountEl=document.getElementById('stepCount');
      const resetSteps=document.getElementById('resetSteps');
      let steps=parseInt(localStorage.getItem('steps')||'0');
      stepCountEl.textContent=steps;
      let chart;

      function renderHistory(){
        const list=JSON.parse(localStorage.getItem('moodHistory')||'[]');
        historyEl.innerHTML='';
        if(list.length===0){historyEl.innerHTML='<div style="color:var(--muted);font-size:13px;padding:8px">No entries yet.</div>';return;}
        list.slice().reverse().forEach(entry=>{
          const el=document.createElement('div');
          el.className='entry';
          el.innerHTML=`<div class="emoji">${entry.emoji}</div><div><div style="font-weight:600">${entry.title}</div><div class="meta">${new Date(entry.time).toLocaleString()}</div></div>`;
          historyEl.appendChild(el);
        });
      }
      function saveToHistory(mood){
        const emojiMap={happy:'ðŸ˜Š',sad:'ðŸ˜”',angry:'ðŸ˜¡',anxious:'ðŸ˜°',tired:'ðŸ¥±',excited:'ðŸ¤©'};
        const list=JSON.parse(localStorage.getItem('moodHistory')||'[]');
        list.push({mood,emoji:emojiMap[mood],title:tasks[mood].title,time:Date.now()});
        if(list.length>100)list.shift();
        localStorage.setItem('moodHistory',JSON.stringify(list));
        renderHistory(); updateChart();
      }
      function selectMood(mood,btn){
        buttons.forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');
        taskTitle.textContent=tasks[mood].title;
        taskDesc.textContent=tasks[mood].desc;
        result.hidden=false;
        saveToHistory(mood);
        localStorage.setItem('lastMood',mood);
      }
      buttons.forEach(btn=>{
        btn.addEventListener('click',()=>selectMood(btn.dataset.mood,btn));
      });
      doneBtn.addEventListener('click',()=>{taskTitle.textContent='Nice work';taskDesc.textContent='You marked the task done. Take a deep breath!';});
      tryAnotherBtn.addEventListener('click',()=>{result.hidden=true;buttons.forEach(b=>b.classList.remove('selected'));});
      clearHistory.addEventListener('click',()=>{if(confirm('Clear all history?')){localStorage.removeItem('moodHistory');renderHistory();updateChart();}});
      themeToggle.addEventListener('click',()=>{const html=document.documentElement;const current=html.getAttribute('data-theme');const newTheme=current==='dark'?'light':'dark';html.setAttribute('data-theme',newTheme);localStorage.setItem('theme',newTheme);});

      // Step counter
      if(window.DeviceMotionEvent){window.addEventListener('devicemotion',function(e){const acc=e.accelerationIncludingGravity;if(!acc)return;const total=Math.abs(acc.x)+Math.abs(acc.y)+Math.abs(acc.z);if(total>25){steps++;stepCountEl.textContent=steps;localStorage.setItem('steps',steps);updateChart();}},true);}
      resetSteps.addEventListener('click',()=>{steps=0;stepCountEl.textContent=steps;localStorage.setItem('steps',steps);updateChart();});

      // Chart
      function updateChart(){
        const ctx=document.getElementById('moodStepChart').getContext('2d');
        const moodHistory=JSON.parse(localStorage.getItem('moodHistory')||'[]');
        const dailyData={};
        moodHistory.forEach(entry=>{
          const d=new Date(entry.time).toLocaleDateString();
          if(!dailyData[d])dailyData[d]={moods:[],steps:0};
          dailyData[d].moods.push(moodScores[entry.mood]||3);
        });
        const today=new Date().toLocaleDateString();
        if(!dailyData[today])dailyData[today]={moods:[],steps:0};
        dailyData[today].steps=steps;
        const labels=Object.keys(dailyData);
        const moodAverages=labels.map(d=>{const arr=dailyData[d].moods;return arr.length?arr.reduce((a,b)=>a+b,0)/arr.length:null;});
        const stepCounts=labels.map(d=>dailyData[d].steps);
        if(chart)chart.destroy();
        chart=new Chart(ctx,{type:'bar',data:{labels,datasets:[
          {label:'Steps',data:stepCounts,backgroundColor:'rgba(91,134,229,0.6)',yAxisID:'y'},
          {label:'Mood Score',data:moodAverages,type:'line',borderColor:'rgba(255,99,132,1)',yAxisID:'y1'}
        ]},options:{responsive:true,scales:{y:{beginAtZero:true},y1:{beginAtZero:true,min:1,max:6,ticks:{stepSize:1}}}}});
      }

      (function init(){
        renderHistory();
        const last=localStorage.getItem('lastMood');
        if(last){const btn=document.querySelector(`.emoji-btn[data-mood="${last}"]`);if(btn)selectMood(last,btn);}
        const theme=localStorage.getItem('theme')||'light';document.documentElement.setAttribute('data-theme',theme);
        updateChart();
      })();
    })();
  </script>
</body>
</html>
